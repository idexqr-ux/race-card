<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ask — Calm QR Companion</title>

  <style>
    :root{
      --bg: #f7f6f3;
      --ink: #2b2b2b;
      --soft: #6b6b6b;
      --card: #ffffff;
      --line: #e3e1db;

      --celadon: #c9d5d0;
      --celadon-ink: #2e3b37;
      --mist: #d9dee1;
      --lemon: #f3f0c7;

      --radius: 18px;
      --shadow: 0 6px 18px rgba(0,0,0,0.06);

      --focus: 0 0 0 4px rgba(201, 213, 208, 0.85);
    }

    *{ box-sizing: border-box; }
    body{
      margin: 0;
      font-family: Georgia, "Times New Roman", Times, serif;
      color: var(--ink);
      background: var(--bg);
      line-height: 1.6;
      padding: 16px;
    }

    .wrap{
      max-width: 760px;
      margin: 0 auto;
    }

    header{
      margin: 6px 0 14px 0;
    }

    h1{
      font-size: 1.35rem;
      margin: 8px 0 6px 0;
      font-weight: 700;
      letter-spacing: 0.2px;
    }

    .sub{
      margin: 0;
      color: var(--soft);
      font-size: 0.98rem;
    }

    .card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
      margin: 12px 0;
    }

    /* Big calm primary */
    .askButton{
      display: grid;
      gap: 8px;
      align-items: center;
      justify-items: center;

      width: 100%;
      min-height: 120px;
      padding: 18px;

      border-radius: 22px;
      border: 2px solid var(--celadon);
      background: linear-gradient(180deg, rgba(201,213,208,0.30), rgba(201,213,208,0.12));
      color: var(--celadon-ink);

      font: inherit;
      cursor: pointer;
      user-select: none;
    }
    .askButton:focus{
      outline: none;
      box-shadow: var(--focus);
    }
    .askBig{
      font-size: 2.1rem;
      letter-spacing: 1px;
      font-weight: 700;
      line-height: 1.1;
    }
    .askHint{
      font-size: 1rem;
      color: rgba(46,59,55,0.85);
      text-align: center;
      max-width: 42ch;
    }

    /* Secondary controls */
    .row{
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    @media (min-width: 680px){
      .row{ grid-template-columns: 1fr 1fr; }
    }

    .btn{
      width: 100%;
      padding: 12px 14px;
      border-radius: 16px;
      border: 1px solid var(--line);
      background: #fff;
      color: var(--ink);
      font: inherit;
      cursor: pointer;
    }
    .btn:focus{ outline: none; box-shadow: var(--focus); }

    .btnSoft{
      background: linear-gradient(180deg, rgba(243,240,199,0.45), rgba(243,240,199,0.15));
      border-color: rgba(227,225,219,1);
    }

    .btnMic{
      border: 1px dashed rgba(107,107,107,0.55);
      background: linear-gradient(180deg, rgba(217,222,225,0.35), rgba(217,222,225,0.10));
      color: #3a3a3a;
    }

    /* Whisper reinforcement chips */
    .chips{
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 10px 0 2px 0;
    }
    .chip{
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: #fff;
      color: var(--soft);
      cursor: pointer;
      user-select: none;
      font-size: 0.98rem;
    }
    .chip:focus{ outline: none; box-shadow: var(--focus); }
    .dot{
      width: 10px; height: 10px; border-radius: 50%;
      background: var(--celadon);
      box-shadow: 0 0 0 3px rgba(201,213,208,0.25);
    }

    /* Output area */
    .outputTitle{
      margin: 0 0 6px 0;
      font-weight: 700;
    }
    .answer{
      margin: 0;
      font-size: 1.05rem;
    }
    .meta{
      margin: 10px 0 0 0;
      padding-top: 10px;
      border-top: 1px solid var(--line);
      color: var(--soft);
      font-size: 0.95rem;
      display: grid;
      gap: 4px;
    }

    /* “Protected wording” block */
    details{
      border: 1px solid var(--line);
      border-radius: 16px;
      background: rgba(201,213,208,0.12);
      padding: 10px 12px;
    }
    details summary{
      cursor: pointer;
      color: var(--celadon-ink);
      font-weight: 700;
      list-style: none;
    }
    details summary::-webkit-details-marker{ display: none; }
    .protected{
      margin: 10px 0 0 0;
      color: #3a3a3a;
      font-size: 0.98rem;
    }
    .protected code{
      background: rgba(255,255,255,0.7);
      border: 1px solid var(--line);
      padding: 0 6px;
      border-radius: 8px;
    }

    /* Quiet input */
    label{
      display: block;
      font-weight: 700;
      margin: 0 0 6px 0;
    }
    input[type="text"]{
      width: 100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid var(--line);
      font: inherit;
      background: #fff;
      color: var(--ink);
    }
    input[type="text"]:focus{
      outline: none;
      box-shadow: var(--focus);
    }

    /* Small utility */
    .srOnly{
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0,0,0,0);
      white-space: nowrap;
      border: 0;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <h1>Ask — Calm QR Companion</h1>
      <p class="sub">Audio-first answers with quiet visual reinforcement. Designed to be read aloud calmly.</p>
    </header>

    <!-- Primary ASK -->
    <button id="askButton" class="askButton" type="button" aria-describedby="askHint">
      <div class="askBig">ASK</div>
      <div id="askHint" class="askHint">
        Tap once for a calm spoken answer. If you prefer, choose a whisper prompt below.
      </div>
    </button>

    <!-- Whisper reinforcement labels -->
    <div class="card" aria-label="Whisper reinforcement">
      <div class="outputTitle">Whisper prompts</div>
      <p class="sub" style="margin-top:0">
        These are gentle “quick asks” — designed to guide without shouting.
      </p>

      <div class="chips" role="list">
        <button class="chip" type="button" data-q="Where am I? What should I look for first?">
          <span class="dot" aria-hidden="true"></span> Calm orientation
        </button>
        <button class="chip" type="button" data-q="What is this card? What can I ask it?">
          <span class="dot" aria-hidden="true"></span> What is this?
        </button>
        <button class="chip" type="button" data-q="Explain the colours and the cap/body/sleeves quietly.">
          <span class="dot" aria-hidden="true"></span> Colours help
        </button>
        <button class="chip" type="button" data-q="Tell me the next practical thing to do here.">
          <span class="dot" aria-hidden="true"></span> Next step
        </button>
        <button class="chip" type="button" data-q="Give me a short, calm summary of the race/showing context.">
          <span class="dot" aria-hidden="true"></span> Quiet summary
        </button>
      </div>
    </div>

    <!-- Optional typed ask + future mic -->
    <div class="card">
      <div class="row">
        <div>
          <label for="typedAsk">Type a question (optional)</label>
          <input id="typedAsk" type="text" inputmode="text" autocomplete="off"
            placeholder="E.g. ‘Who is the favourite?’ or ‘What does this colour mean?’" />
          <div class="srOnly" id="typedHelp">Type your question then press Speak answer.</div>
        </div>

        <div style="align-self:end; display:grid; gap:10px;">
          <button id="speakBtn" class="btn btnSoft" type="button">
            Speak answer (calm)
          </button>
          <button id="micBtn" class="btn btnMic" type="button" aria-describedby="micNote">
            Future voice input (mock)
          </button>
        </div>
      </div>

      <p id="micNote" class="sub" style="margin:10px 0 0 0">
        Voice input isn’t active yet. This button demonstrates the flow and wording we’ll keep.
      </p>
    </div>

    <!-- Output -->
    <div class="card" aria-live="polite" aria-atomic="true">
      <div class="outputTitle">Answer</div>
      <p id="answer" class="answer">
        Tap <strong>ASK</strong> to begin. The companion will speak first, and show a gentle written echo after.
      </p>

      <div class="meta">
        <div><strong>Mode:</strong> <span id="mode">Audio-first</span></div>
        <div><strong>Reinforcement:</strong> <span id="reinforce">Written whisper echo</span></div>
        <div><strong>Status:</strong> <span id="status">Ready</span></div>
      </div>
    </div>

    <!-- Protected wording -->
    <div class="card">
      <details>
        <summary>Protected wording (kept calm by design)</summary>
        <p class="protected">
          This companion avoids urgency, judgement, and loud instruction.
          It uses short, steady phrasing and will never say “must”, “wrong”, or “obvious”.
          <br><br>
          When we add real voice input later, we’ll keep the same flow:
          <code>listen → confirm quietly → speak → show a soft echo</code>.
        </p>
      </details>
    </div>
  </div>

  <script>
    // --- Calm speech helpers (audio-first behaviour) ---
    const ttsAvailable = "speechSynthesis" in window && "SpeechSynthesisUtterance" in window;

    function calmSpeak(text){
      const status = document.getElementById("status");
      status.textContent = ttsAvailable ? "Speaking" : "Speech not available (text only)";

      // Always update the written echo (visual whisper reinforcement)
      setAnswer(text);

      if(!ttsAvailable) return;

      // Stop any previous speech
      window.speechSynthesis.cancel();

      const u = new SpeechSynthesisUtterance(text);

      // Default voice settings kept neutral; user device decides voice.
      // Keep it gentle: slightly slower, slightly lower pitch.
      u.rate = 0.95;
      u.pitch = 0.95;
      u.volume = 1;

      u.onend = () => { status.textContent = "Ready"; };
      u.onerror = () => { status.textContent = "Speech error (text shown)"; };

      window.speechSynthesis.speak(u);
    }

    function setAnswer(text){
      const a = document.getElementById("answer");
      a.textContent = text;
    }

    // --- Mocked "brain" for now (swap later for your real Q&A / data lookups) ---
    // This is deliberately calm, orienting, and non-judgemental.
    function generateCalmAnswer(question){
      const q = (question || "").trim().toLowerCase();

      // Orientation first, always.
      const orientation = "You’re in the Ask companion. I can speak answers and show a quiet written echo. You can tap a whisper prompt, or type a question.";

      if(!q){
        return orientation + " What would you like to know — the colours, the course, or the next step?";
      }

      // Soft pattern matches (keep these small and safe; expand later)
      if(q.includes("where am i") || q.includes("orientation") || q.includes("look for first")){
        return "Start with one calm landmark: find the main title at the top of the page. Then choose a whisper prompt. If this is on a racecard, look for the horse name, number, and colours first — that’s enough to begin.";
      }

      if(q.includes("what is this") || q.includes("what can i ask")){
        return "This is a calm Q&A layer linked from a QR code. You can ask for colours, simple explanations, or what to do next. It is designed to help without flooding you with detail.";
      }

      if(q.includes("colour") || q.includes("colors") || q.includes("cap") || q.includes("sleeve")){
        return "Colours are described in a consistent order: cap, body, sleeves. They help you spot the right horse or rider. If you tell me a colour line, I can repeat it clearly and explain any tricky phrasing.";
      }

      if(q.includes("next") || q.includes("what do i do") || q.includes("practical")){
        return "Choose one small action: pick one horse or one class entry and ask about it. If you’re at the venue, decide your nearest landmark next — paddock, ring, collecting area, or finish line — and I can guide you from there.";
      }

      if(q.includes("summary") || q.includes("context")){
        return "Here’s a quiet summary: this companion exists to reduce searching and help you stay oriented. It will prioritise calm explanation first, and only add detail if you ask for it.";
      }

      // Default: acknowledge gently, offer next step
      return orientation + " Your question was: “" + question.trim() + "”. If you want, rephrase it as one of these: who, what, where, or explain.";
    }

    // --- Wiring ---
    const askButton = document.getElementById("askButton");
    const speakBtn = document.getElementById("speakBtn");
    const micBtn = document.getElementById("micBtn");
    const typedAsk = document.getElementById("typedAsk");
    const statusEl = document.getElementById("status");

    // Primary ASK: speak a calm orientation + invitation
    askButton.addEventListener("click", () => {
      statusEl.textContent = "Thinking";
      const answer = generateCalmAnswer("");
      calmSpeak(answer);
    });

    // Speak typed ask
    speakBtn.addEventListener("click", () => {
      statusEl.textContent = "Thinking";
      const q = typedAsk.value || "";
      const answer = generateCalmAnswer(q);
      calmSpeak(answer);
    });

    // Enter key in input triggers speak
    typedAsk.addEventListener("keydown", (e) => {
      if(e.key === "Enter"){
        e.preventDefault();
        speakBtn.click();
      }
    });

    // Whisper chips
    document.querySelectorAll(".chip").forEach(btn => {
      btn.addEventListener("click", () => {
        statusEl.textContent = "Thinking";
        const q = btn.getAttribute("data-q") || "";
        typedAsk.value = q; // gentle reinforcement: shows what was asked
        const answer = generateCalmAnswer(q);
        calmSpeak(answer);
      });
    });

    // Future voice input (mock flow)
    micBtn.addEventListener("click", () => {
      // This is where we’ll later add Web Speech API or another voice input method.
      // For now we keep the behavioural pattern and protected wording.
      const mock = "Voice input will be added later. For now, you can tap a whisper prompt or type a short question, then choose Speak answer.";
      calmSpeak(mock);
    });

    // Initial status
    document.getElementById("mode").textContent = ttsAvailable ? "Audio-first (TTS available)" : "Text-first (no TTS)";
  </script>
</body>
</html>
