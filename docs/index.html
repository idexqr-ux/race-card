<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>The Race Card</title>

  <style>
    body {
      font-family: Georgia, "Times New Roman", Times, serif;
      color: #2b2b2b;
      background: #f7f6f3;
      line-height: 1.6;
      padding: 16px;
    }

    h1 {
      font-size: 1.4em;
      margin: 12px 0;
      color: #1f1f1f;
    }

    /* ASK — big, calm, phone-first */
    #askButton {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;

      width: 100%;
      max-width: 560px;
      margin: 0 auto 24px auto;

      min-height: 112px;
      padding: 20px;

      font-family: inherit;
      font-size: 2em;
      line-height: 1.1;

      border-radius: 999px;
      border: none;
      background: #ffffff;
      color: #2b2b2b;

      box-shadow: 0 3px 10px rgba(0,0,0,0.12);
      cursor: pointer;
    }

    .ask-sub {
      font-size: 0.8em;
      margin-top: 6px;
      color: #5a5a5a;
    }

    .panel {
      background: #ffffff;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.06);
    }

    #answerText {
      min-height: 3em;
      opacity: 0.85;
    }

    .back-link {
      display: inline-block;
      margin-top: 14px;

      font-size: 1.05em;      /* slightly clearer */
      color: #6a6a6a;

      padding: 12px 8px;      /* invisible finger comfort */
      border-radius: 10px;

      cursor: pointer;
      -webkit-tap-highlight-color: rgba(0,0,0,0);
    }

    .back-link:hover {
      color: #2b2b2b;
    }
  </style>
</head>

<body>

  <div id="raceContext" aria-hidden="true">Race</div>

  <button id="askButton" type="button" aria-pressed="false">
    <div>Ask</div>
    <div class="ask-sub" id="statusLine">about the race card</div>
  </button>

  <h1>The Race Card</h1>

  <div class="panel">
    <p id="answerText" role="status" aria-live="polite">&nbsp;</p>
  </div>

  <div class="back-link" onclick="goBackSmart()">
    ← Back to race
  </div>

  <script>
    // Race context (quiet label, future multi-race ready)
    const raceContext = document.getElementById('raceContext');
    const params = new URLSearchParams(window.location.search);
    const race = params.get('race');
    if (raceContext) {
      raceContext.textContent = race ? `Race ${race}` : "Race";
    }

    // Smart back: avoids returning to GitHub Pages settings when testing on laptop
    function goBackSmart() {
      if (window.history.length > 1) {
        window.history.back();
        return;
      }
      // Fallback stays within your GitHub Pages site
      window.location.href = "./";
    }

    (function () {
      // Hook to your existing elements
      const btn = document.getElementById('askButton');
      const status = document.getElementById('statusLine');
      const panel = document.getElementById('answerText');

      // Step 4: Intent cards (factual expansion, companion tone)
      const intents = [
        {
          id: "form",
          label: "Form comment",
          example: "What does ‘ev ch til drvn & one pce 3 out’ mean?",
          answer:
            "This is shorthand describing how the horse travelled during the race. Expanded into plain English, it means the horse was always prominent, was being pushed along before the finish, and could only maintain one pace from three fences out."
        },
        {
          id: "term",
          label: "Racing term",
          example: "What does OR mean?",
          answer:
            "OR stands for Official Rating. It’s a numerical assessment of a horse’s ability, used to help level the field in handicaps."
        },
        {
          id: "going",
          label: "Going / ground",
          example: "Why does the going matter?",
          answer:
            "The going describes how firm or soft the ground is. Some horses perform best on soft ground, others on firmer ground, so it can significantly affect how a race unfolds."
        },
        {
          id: "colours",
          label: "Colours",
          example: "What do the colours tell me?",
          answer:
            "The colours identify the owner and help you visually follow a horse during the race. They don’t affect performance, but they make tracking the right runner much easier."
        },
        {
          id: "race-type",
          label: "Race type",
          example: "What’s a novice race?",
          answer:
            "A novice race is restricted to horses that have not won before a certain date or over a certain discipline, allowing less experienced horses to compete against similar rivals."
        },
        {
          id: "how-to-read",
          label: "How to read the card",
          example: "What should I look at first?",
          answer:
            "Most people start with the horse’s recent form, the going, and the race type. You don’t need to read everything — just enough to orient yourself before the race begins."
        }
      ];

      let intentIndex = 0;
      let state = "idle"; // idle | listening | answering

      function showAnswer() {
        const intent = intents[intentIndex % intents.length];
        panel.textContent = intent.answer;
        intentIndex++;
      }

      function setState(next) {
        state = next;

        if (state === "idle") {
          status.textContent = "about the race card";
          panel.innerHTML = "&nbsp;";
          btn.setAttribute("aria-pressed", "false");
          return;
        }

        if (state === "listening") {
          status.textContent = "Listening…";
          panel.textContent = "Say your question as you would to the person beside you.";
          btn.setAttribute("aria-pressed", "true");
          return;
        }

        // answering
        status.textContent = "Answer";
        showAnswer();
        btn.setAttribute("aria-pressed", "false");
      }

      btn.addEventListe
